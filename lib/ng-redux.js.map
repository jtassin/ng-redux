{"version":3,"file":"ng-redux.js","sources":["../src/utils/shallowEqual.js","../src/utils/wrapActionCreators.js","../src/components/connector.js","../src/components/digestMiddleware.js","../src/components/ngRedux.js","../src/index.js"],"sourcesContent":[" export default function shallowEqual(objA, objB) {\n   if (objA === objB) {\n     return true;\n   }\n\n   /* $$hashKey is added by angular when using ng-repeat, we ignore that*/\n   var keysA = Object.keys(objA).filter(k => k !== '$$hashKey');\n   var keysB = Object.keys(objB).filter(k => k !== '$$hashKey');\n\n   if (keysA.length !== keysB.length) {\n     return false;\n   }\n\n   // Test for A's keys different from B.\n   var hasOwn = Object.prototype.hasOwnProperty;\n   for (let i = 0; i < keysA.length; i++) {\n     if (!hasOwn.call(objB, keysA[i]) ||\n       objA[keysA[i]] !== objB[keysA[i]]) {\n       return false;\n     }\n   }\n\n   return true;\n }","import { bindActionCreators } from 'redux';\n\nexport default function wrapActionCreators(actionCreators) {\n  return dispatch => bindActionCreators(actionCreators, dispatch);\n}\n","import shallowEqual from '../utils/shallowEqual';\nimport wrapActionCreators from '../utils/wrapActionCreators';\nimport invariant from 'invariant';\n\nimport isPlainObject from 'lodash.isplainobject';\nimport isFunction from 'lodash.isfunction';\nimport isObject from 'lodash.isobject';\n\nconst assign = Object.assign;\nconst defaultMapStateToTarget = () => ({});\nconst defaultMapDispatchToTarget = dispatch => ({dispatch});\n\nexport default function Connector(store) {\n  return (mapStateToTarget, mapDispatchToTarget) => {\n\n    let finalMapStateToTarget = mapStateToTarget || defaultMapStateToTarget;\n\n    const finalMapDispatchToTarget = isPlainObject(mapDispatchToTarget) ?\n      wrapActionCreators(mapDispatchToTarget) :\n      mapDispatchToTarget || defaultMapDispatchToTarget;\n\n    invariant(\n      isFunction(finalMapStateToTarget),\n      'mapStateToTarget must be a Function. Instead received %s.', finalMapStateToTarget\n      );\n\n    invariant(\n      isPlainObject(finalMapDispatchToTarget) || isFunction(finalMapDispatchToTarget),\n      'mapDispatchToTarget must be a plain Object or a Function. Instead received %s.', finalMapDispatchToTarget\n      );\n\n    let slice = getStateSlice(store.getState(), finalMapStateToTarget, false);\n    const isFactory = isFunction(slice);\n\n    if (isFactory) {\n      finalMapStateToTarget = slice;\n      slice = getStateSlice(store.getState(), finalMapStateToTarget);\n    }\n\n    const boundActionCreators = finalMapDispatchToTarget(store.dispatch);\n\n    return (target) => {\n\n      invariant(\n        isFunction(target) || isObject(target),\n        'The target parameter passed to connect must be a Function or a object.'\n        );\n\n      //Initial update\n      updateTarget(target, slice, boundActionCreators);\n\n      const unsubscribe = store.subscribe(() => {\n        const nextSlice = getStateSlice(store.getState(), finalMapStateToTarget);\n        if (!shallowEqual(slice, nextSlice)) {\n          slice = nextSlice;\n          updateTarget(target, slice, boundActionCreators);\n        }\n      });\n      return unsubscribe;\n    }\n\n  }\n}\n\nfunction updateTarget(target, StateSlice, dispatch) {\n  if(isFunction(target)) {\n    target(StateSlice, dispatch);\n  } else {\n    assign(target, StateSlice, dispatch);\n  }\n}\n\nfunction getStateSlice(state, mapStateToScope, shouldReturnObject = true) {\n  const slice = mapStateToScope(state);\n\n  if (shouldReturnObject) {\n    invariant(\n      isPlainObject(slice),\n      '`mapStateToScope` must return an object. Instead received %s.',\n      slice\n      );\n  } else {\n    invariant(\n      isPlainObject(slice) || isFunction(slice),\n      '`mapStateToScope` must return an object or a function. Instead received %s.',\n      slice\n      );\n  }\n\n  return slice;\n}\n","import debounce from 'lodash.debounce';\n\nexport default function digestMiddleware($rootScope, debounceConfig) {\n  let debouncedFunction = $rootScope.$evalAsync;\n  if(debounceConfig && debounceConfig.wait && debounceConfig.wait > 0) {\n    debouncedFunction = debounce($rootScope.$evalAsync, debounceConfig.wait, { maxWait: debounceConfig.maxWait });\n  }\n  return store => next => action => {\n    const res = next(action);\n    debouncedFunction(res);\n    return res;\n  };\n}\n","import Connector from './connector';\nimport invariant from 'invariant';\nimport {createStore, applyMiddleware, compose, combineReducers} from 'redux';\nimport digestMiddleware from './digestMiddleware';\n\nimport curry from 'lodash.curry';\nimport isFunction from 'lodash.isfunction';\nimport map from 'lodash.map';\n\nconst isArray = Array.isArray;\n\nconst typeIs = curry((type, val) => typeof val === type);\nconst isObject = typeIs('object');\nconst isString = typeIs('string');\nconst assign  = Object.assign;\n\nexport default function ngReduxProvider() {\n  let _reducer = undefined;\n  let _middlewares = undefined;\n  let _storeEnhancers = undefined;\n  let _initialState = undefined;\n  let _reducerIsObject = undefined;\n\n  this.createStoreWith = (reducer, middlewares, storeEnhancers, initialState) => {\n    invariant(\n      isFunction(reducer) || isObject(reducer),\n      'The reducer parameter passed to createStoreWith must be a Function or an Object. Instead received %s.',\n      typeof reducer\n    );\n\n    invariant(\n      !storeEnhancers || isArray(storeEnhancers),\n      'The storeEnhancers parameter passed to createStoreWith must be an Array. Instead received %s.',\n      typeof storeEnhancers\n    );\n\n    _reducer = reducer;\n    _reducerIsObject = isObject(reducer);\n    _storeEnhancers = storeEnhancers || [];\n    _middlewares = middlewares || [];\n    _initialState = initialState || {};\n  };\n\n  this.config = {\n    debounce: {\n      wait: undefined,\n      maxWait: undefined,\n    },\n  };\n\n  this.$get = ($injector) => {\n    const resolveMiddleware = middleware => isString(middleware)\n      ? $injector.get(middleware)\n      : middleware;\n\n    const resolvedMiddleware = map(_middlewares, resolveMiddleware);\n\n    const resolveStoreEnhancer = storeEnhancer => isString(storeEnhancer)\n      ? $injector.get(storeEnhancer)\n      : storeEnhancer;\n\n    const resolvedStoreEnhancer = map(_storeEnhancers, resolveStoreEnhancer);\n\n    if (_reducerIsObject) {\n      const getReducerKey = key => isString(_reducer[key])\n        ? $injector.get(_reducer[key])\n        : _reducer[key];\n\n      const resolveReducerKey = (result, key) => assign({}, result,\n        { [key]: getReducerKey(key) }\n      );\n\n      const reducersObj = Object\n        .keys(_reducer)\n        .reduce(resolveReducerKey, {});\n\n      _reducer = combineReducers(reducersObj);\n    }\n\n    // digestMiddleware needs to be the last one.\n    resolvedMiddleware.push(digestMiddleware($injector.get('$rootScope'), this.config.debounce));\n\n    // combine middleware into a store enhancer.\n    const middlewares = applyMiddleware(...resolvedMiddleware);\n\n    // compose enhancers with middleware and create store.\n    const store = createStore(_reducer, _initialState, compose(middlewares, ...resolvedStoreEnhancer));\n\n    return assign({}, store, { connect: Connector(store) });\n  };\n\n  this.$get.$inject = ['$injector'];\n}\n","import ngReduxProvider from './components/ngRedux';\n\nexport default angular.module('ngRedux', [])\n  .provider('$ngRedux', ngReduxProvider)\n  .name;"],"names":["shallowEqual","objA","objB","keysA","filter","k","keysB","length","hasOwn","Object","prototype","hasOwnProperty","i","call","wrapActionCreators","actionCreators","bindActionCreators","dispatch","assign","defaultMapStateToTarget","defaultMapDispatchToTarget","Connector","store","mapStateToTarget","mapDispatchToTarget","finalMapStateToTarget","finalMapDispatchToTarget","isPlainObject","isFunction","slice","getStateSlice","getState","isFactory","boundActionCreators","target","isObject","unsubscribe","subscribe","nextSlice","updateTarget","StateSlice","state","mapStateToScope","shouldReturnObject","digestMiddleware","$rootScope","debounceConfig","debouncedFunction","$evalAsync","wait","debounce","maxWait","res","next","action","isArray","Array","typeIs","curry","type","val","isString","ngReduxProvider","_reducer","undefined","_middlewares","_storeEnhancers","_initialState","_reducerIsObject","createStoreWith","reducer","middlewares","storeEnhancers","initialState","config","$get","$injector","resolveMiddleware","middleware","get","resolvedMiddleware","map","resolveStoreEnhancer","storeEnhancer","resolvedStoreEnhancer","getReducerKey","key","resolveReducerKey","result","reducersObj","reduce","combineReducers","push","applyMiddleware","createStore","compose","connect","$inject","angular","module","provider","name"],"mappings":"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"}